{% extends "orden_facturacion_nuevo.html" %}
{% load crispy_forms_tags %}
{% block editar%}
{% load index %}
<h2>Orden de Facturación</h2>
{% if form.estado.value == "IMPE" %}
<div class="form-row">
    <div class="col-6 mb-0">
        <div id="div_id_n_tramite" class="form-group">
            <label for="id_n_tramite" class="col-form-label requiredField">
                N° de trámite<span class="asteriskField">*</span>
            </label>
            <div class="">
                {{form.n_tramite}}
            </div>
        </div>
    </div>
    <div class="col-6 mb-0">
        <div id="div_id_n_factura" class="form-group">

            <label for="id_n_factura" class="col-form-label requiredField">
                N° de factura<span class="asteriskField">*</span>
            </label>
            <div class="">
                {{form.n_factura}}
            </div>
        </div>
    </div>
    <div class="col-12 mb-0">
        <div id="div_id_anexo_factura" class="form-group">
            <label for="id_anexo_factura" class="col-form-label requiredField">
                Anexo de factura<span class="asteriskField">*</span>
            </label>
            <div class="">
                {{form.anexo_factura}}
            </div>
        </div>
    </div>
</div>
<hr>

{% block anexos%}
<script>
    var has_anexo = false;
    var has_n_tra = false;
    var has_n_fact = false;

    function isInteger(str) {
        return /^\d*$/.test(str);
    }

    function change_state_btn(){
        if (has_anexo && has_n_tra && has_n_fact){
            $('#confirmar_guardar').removeClass('disabled')
        }
        else{
            $('#confirmar_guardar').addClass('disabled')
        }
    }

    $('#confirmar_guardar').addClass('disabled')
    $("#id_anexo_factura").change(function () {
        has_anexo=$(this).get(0).files.length !== 0;
        change_state_btn()
    });

    $("#id_n_factura").focusout(function () {
        has_n_fact = isInteger($(this).val());
        change_state_btn()
    });

    $("#id_n_tramite").focusout(function () {
        has_n_tra = isInteger($(this).val());
        change_state_btn()
    });
</script>
{% endblock anexos%}

{% endif %}


<input type="hidden" id='rc' value="{{form.ruc_ci.value}}">
<input type="hidden" id='rn' value="{{form.razon_nombres.value}}">
{% endblock editar%}

{% block btn %}
{% if form.estado.value == "ACTV" %}
<a class="btn btn-success float-right" href="{% url 'orden_facturacion_estado' orden_id%}">Enviar solicitud</a>
{% endif %}
{% endblock btn %}

{% block n_par %}
{% if form.estado.value != "ACTV" %}
<div class="col-6 col-md-4">{{ form.n_participantes|as_crispy_field}}</div>
{%else%}
{{block.super}}
{% endif %}
{% endblock n_par %}

{% block participantes %}
{% for n in num%}
<div id="div_{{n}}" class="col-12 col-md-6">
    <div class="row">
        {% if form.estado.value == "ACTV" %}
        <div class="col-2">
            <a class="btn btn-danger btn-sm remove" id="{{n}}" href="#">Eliminar</a>
        </div>
        <div class="col-10">
            <select name="{{ form.participantes.name }}" id="id_participantes_{{n}}"
                class="select2 form-control select2-participantes">
                <option value="None" selected>-----------</option>
                {% for value, text in form.participantes.field.choices %}
                <option value='{{value}}' {% if value == selected_participantes|index:n %} selected="selected"
                    {% endif %}>{{text}}</option>
                {% endfor %}
            </select>
        </div>
        {%else%}
        <div class="col-12">
            <select name="{{ form.participantes.name }}" id="id_participantes_{{n}}"
                class="form-control select2-participantes" readonly>
                {% for value, text in form.participantes.field.choices %}
                {% if value == selected_participantes|index:n %}
                <option value='{{value}}' selected>{{text}}</option>
                {% endif %}
                {% endfor %}
            </select>
        </div>
        {%endif%}

    </div>

    {% if form.participantes.errors %}
    {% for error in form.participantes.errors %}
    <p class="invalid-feedback d-block">
        <strong>{{ error }}</strong>
    </p>
    {% endfor %}
    {% endif %}
</div>
{% endfor %}
{% endblock participantes%}

{% block vars %}
<script>
    var a = $('#id_n_participantes').val();
    var cont = a;
</script>
{% endblock vars %}

{% block fields %}
{% endblock fields %}